### Citation: Mangiafico, S.S. 2016. Summary and Analysis of Extension
### Program Evaluation in R, version 1.6.2 rcompanion.org/handbook/.
###Pdf version: rcompanion.org/documents/RHandbookProgramEvaluation.pdf


if(!require(car)){install.packages("car")}
if(!require(lsmeans)){install.packages("lsmeans")}
if(!require(multcompView)){install.packages("multcompView")}
if(!require(ggplot2)){install.packages("ggplot2")}

data(esoph)
model = glm(cbind(ncases, ncontrols) ~ tobgp * alcgp,
              data = esoph, family = binomial())
library(car)
Anova(model)

library(lsmeans)

### One-way comparison

leastsquare = lsmeans(model,
                      pairwise ~ alcgp,
                      adjust="tukey")       
                         ### Tukey-adjusted comparisons
leastsquare$contrasts

cld(leastsquare,
    alpha=0.05,
    Letters=letters,      ### Use lower-case letters for .group
    adjust="tukey")       ### Tukey-adjusted comparisons 


### Two-way comparison

leastsquare2 = lsmeans(model,
                       pairwise ~ tobgp:alcgp,
                       adjust="tukey")       
                          ### Tukey-adjusted comparisons
leastsquare2$contrasts

cld(leastsquare2,
    alpha=0.05,
    type="response",      ### Show estimates in original scale
    Letters=letters,      ### Use lower-case letters for .group
    adjust="tukey")       ### Tukey-adjusted comparisons


### Plot

CLD = cld(leastsquare,
          alpha=0.05,
          type ="response",
          Letters=letters,
          adjust="tukey") 

library(ggplot2)

qplot(x    =  alcgp,
      y    =  prob,
      data =  CLD) +

geom_errorbar(aes( ymin = asymp.LCL,
                   ymax = asymp.UCL,
                   width = 0.15))